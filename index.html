<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìµœì¢… ì •ì‚° ê³„ì‚°ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-xl">
    <h1 class="text-2xl font-bold text-center text-blue-700 mb-6">ğŸ“Š ìµœì¢… ì •ì‚° ê³„ì‚°ê¸°</h1>

    <!-- ì›ê¸ˆ -->
    <div class="mb-4">
      <label class="block font-semibold mb-1">ğŸ’° ì›ê¸ˆ (â‚©)</label>
      <input type="text" id="principal"
        placeholder="ì˜ˆ: 1,000,000"
        class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" />
    </div>

    <!-- ì´ììœ¨ -->
    <div class="mb-4">
      <label class="block font-semibold mb-1">ğŸ“‰ ì´ììœ¨ (%)</label>
      <input type="number" id="interestRate" value="1.66" step="0.01"
        class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" />
    </div>

    <!-- ì¶”ê°€ í•­ëª© -->
    <div class="mb-4">
      <label class="block font-semibold mb-2">â• ì¶”ê°€ í•­ëª©</label>
      <div id="items" class="space-y-2">
        <div class="flex gap-2">
          <input type="text" placeholder="í•­ëª© ì´ë¦„" class="item-name w-1/2 p-2 border rounded-md" />
          <input type="text" placeholder="ê¸ˆì•¡" class="item-cost w-1/2 p-2 border rounded-md" />
        </div>
      </div>
      <button onclick="addItem()"
        class="mt-2 px-3 py-1 bg-green-500 text-white rounded-md hover:bg-green-600 transition">+ í•­ëª© ì¶”ê°€</button>
    </div>

    <!-- ê³„ì‚° ë²„íŠ¼ -->
    <div class="text-center mt-6">
      <button onclick="calculate()"
        class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white text-lg font-semibold rounded-lg transition">
        ê³„ì‚°í•˜ê¸°
      </button>
    </div>

    <!-- ê²°ê³¼ -->
    <div id="result" class="mt-6 bg-gray-50 border border-blue-200 p-4 rounded-lg hidden">
      <h2 class="text-lg font-bold text-blue-600 mb-2">ğŸ“Œ ì •ì‚° ê²°ê³¼</h2>
      <div id="resultDetails" class="text-gray-700 space-y-1 text-sm"></div>
      <div class="mt-3 font-bold text-green-600 text-xl" id="finalAmount"></div>
	<div class="mt-3 text-right">
	  <button onclick="copyResult()"
		class="text-sm bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded-md text-gray-800 transition">ğŸ“‹ ê²°ê³¼ ë³µì‚¬í•˜ê¸°</button>
	</div>
    </div>
  </div>

  <script>
  function copyResult() {
  const resultEl = document.getElementById("resultDetails");
  const finalAmount = document.getElementById("finalAmount").textContent;
  const tempEl = document.createElement("textarea");

  // HTML â†’ í…ìŠ¤íŠ¸ ë³€í™˜ìš©
  const textContent = resultEl.innerText + '\n' + finalAmount;

  tempEl.value = textContent;
  document.body.appendChild(tempEl);
  tempEl.select();
  document.execCommand("copy");
  document.body.removeChild(tempEl);

  // ì•Œë¦¼
  alert("ğŸ“‹ ì •ì‚° ê²°ê³¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
}

    function formatNumberInput(e) {
      const input = e.target;
      const cursorPosition = input.selectionStart;
      const originalLength = input.value.length;

      const numericOnly = input.value.replace(/[^\d]/g, '');
      if (numericOnly === '') {
        input.value = '';
        return;
      }

      const formatted = Number(numericOnly).toLocaleString();
      input.value = formatted;

      const newLength = formatted.length;
      const diff = newLength - originalLength;
      input.setSelectionRange(cursorPosition + diff, cursorPosition + diff);
    }

    function bindFormatEvents() {
      const inputs = document.querySelectorAll('#principal, .item-cost');
      inputs.forEach(input => {
        input.removeEventListener('input', formatNumberInput);
        input.addEventListener('input', formatNumberInput);
      });
    }

    function unformatNumber(str) {
      return parseFloat(str.replace(/,/g, '')) || 0;
    }

	function addItem() {
	  const container = document.getElementById("items");
	  const div = document.createElement("div");
	  div.className = "flex gap-2 items-center group";

	  div.innerHTML = `
		<input type="text" placeholder="í•­ëª© ì´ë¦„" class="item-name w-1/2 p-2 border rounded-md" />
		<input type="text" placeholder="ê¸ˆì•¡" class="item-cost w-1/2 p-2 border rounded-md" />
		<button type="button" class="text-red-500 text-lg font-bold px-2 hover:text-red-700" onclick="removeItem(this)">âŒ</button>
	  `;

	  container.appendChild(div);
	  bindFormatEvents();
	}
	function removeItem(button) {
	  const itemRow = button.parentElement;
	  itemRow.remove();
	}

    function calculate() {
      const principal = unformatNumber(document.getElementById("principal").value);
      const interestRate = parseFloat(document.getElementById("interestRate").value) || 0;

      const itemNames = document.querySelectorAll(".item-name");
      const itemCosts = document.querySelectorAll(".item-cost");

      let totalExtra = 0;
      let details = "";

      for (let i = 0; i < itemCosts.length; i++) {
        const name = itemNames[i].value || `í•­ëª©${i + 1}`;
        const cost = unformatNumber(itemCosts[i].value);
        totalExtra += cost;
        details += `<div>ğŸ”¹ ${name}: â‚©${cost.toLocaleString()}</div>`;
      }

      const interest = principal * (interestRate / 100);
      const final = principal - interest - totalExtra;

      document.getElementById("result").classList.remove("hidden");
      document.getElementById("resultDetails").innerHTML = `
        ğŸ’° ì›ê¸ˆ: â‚©${principal.toLocaleString()}<br/>
        ğŸ“‰ ì´ì (${interestRate}%): â‚©${interest.toLocaleString()}<br/>
        ${details}
      `;
      document.getElementById("finalAmount").textContent = `âœ… ìµœì¢… ê¸ˆì•¡: â‚©${final.toLocaleString()}`;
    }

    window.addEventListener('DOMContentLoaded', () => {
      bindFormatEvents();
    });
  </script>
</body>
</html>
